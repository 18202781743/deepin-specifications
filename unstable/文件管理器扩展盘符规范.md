# 文件管理器扩展盘符规范

> __警告！此规范内容是不稳定版本，可能会发生破坏兼容性的更新。当无法保障向下兼容时，将会升级此文档的主版本号，如从“1.0”更新到“2.0”。反之，普通更新只会升级次版本号，如“1.0”更新到“1.1”，其对“1.0”版本向下兼容。请在使用前确认此文档的版本号，并为将来可能发生的兼容性变化做好准备。__

* 维护者：xust xushitong@uniontech.com
* 修改日期：2022.3.11
* 版本：1.0
* 议题：#3

## 引言

本文档规定了文件管理器中，应用程序入口相关的配置文件的格式、安装路径等规范。

## 名词解释

* 应用程序入口：提供应用程序的访问方式
* 入口配置文件：提供在文件管理器中显示应用入口的配置信息

## 角色说明

* 第三方应用程序：需要在文件管理器中添加其应用入口的第三方应用程序
* 配置文件：常规 desktop 文件
* 文件管理器：提供第三方应用程序入口的主应用

## 配置描述文件

该功能使用标准 `.desktop` 文件作为应用入口配置文件。

其格式应如下（如百度网盘应用的 desktop 文件）：

```
[Desktop Entry]
Name=baidunetdisk
Exec=/opt/baidunetdisk/baidunetdisk --no-sandbox %U
Terminal=false
Type=Application
Icon=baidunetdisk
StartupWMClass=baidunetdisk
Comment=百度网盘
MimeType=x-scheme-handler/baiduyunguanjia;
Categories=Network;
```

该 feature 所应用的字段说明：

| 字段名 | 用途                                                         |
| ------ | ------------------------------------------------------------ |
| Name   | 显示在文件管理器计算机页面的应用程序名称                     |
| Icon   | 应用图标的数据来源，通过 `QIcon::fromTheme` 显示             |
| Exec   | 双击应用时获取该字段内容以执行程序，该字段中的 `%U, %u, %F, %f` 参数会被忽略。同时，该字段内容会被用于判定该应用程序是否存在，当应用程序的可执行文件不存在时，该入口不被显示在计算机页面 |

其余字段目前暂未使用。

## 配置文件安装路径

1. `/usr/etc/dde-file-manager/volume` 应用预装位置
2. `/etc/dde-file-manager/volume` OEM 人员定制进程入口位置

在文件管理器安装后，以上路径即自动创建（目前仅路径 3 会自动创建，后续将同步创建路径 1、2），第三方应用程序无需主动创建。在第三方应用程序安装过程中，将自己的标准 .desktop 文件复制一份到该路径即可。

复制完成后，应能在文件管理器中实时看到本应用程序入口的添加。

如需从文件管理器中移除该应用程序入口，仅需将配置文件从配置路径中删除即可，在文件管理器中应能实时响应应用程序入口的移除。

## 兼容性说明

该功能在 1040 版本中的文件管理器提供，并会向后进行兼容。

`/usr/share/dde-file-manager/extensions/appEntry` 是目前对外提供的入口文件存放地址，不建议第三方应用程序使用该路径，但该路径会保留作为兼容处理。建议第三方应用开发者使用 `/usr/etc/dde-file-manager/volume`中路径存放入口文件，oem厂商使用`/etc/dde-file-manager/volume`。
